<html>
<head>
    <title>Sensor Comparison</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
</head>
<body>
    <h1>Sensor Comparison</h1>
    <h2>Temperature</h2>
    <canvas id="tempChart"></canvas>
    <h2>Humidity</h2>
    <canvas id="humChart"></canvas>
    <h2>Pressure</h2>
    <canvas id="pressChart"></canvas>

    <script>
        const allData = {{ all_data | tojson }};

        const colors = {
            'INSIDE': 'rgb(255, 99, 132)',
            'OUTSIDE': 'rgb(54, 162, 235)',
            'GARAGE': 'rgb(75, 192, 192)'
        };

        // Use timestamps from first sensor as x-axis labels

function makeChart(canvasId, field, unit) {
    const datasets = Object.entries(allData).map(([sensorId, data], index) => ({
        label: sensorId,
        data: data.map(d => ({ x: new Date(d.timestamp), y: d[field] })),
        borderColor: colors[sensorId],
        backgroundColor: colors[sensorId] + '33',
        tension: 0.1
    }));
    new Chart(document.getElementById(canvasId), {
        type: 'line',
        data: { datasets },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' }
            },
            scales: {
                x: { 
                    type: 'time',
                    time: { tooltipFormat: 'dd/MM/yyyy HH:mm' },
                    ticks: { maxTicksLimit: 12 }
                },
                y: { 
                    title: { display: true, text: unit },
                    grace: '20%'
                }
            }
        }
    });
}
        makeChart('tempChart', 'temperature', 'Â°C');
        makeChart('humChart', 'humidity', '%');
        makeChart('pressChart', 'pressure', 'hPa');
    </script>
</body>
</html>

